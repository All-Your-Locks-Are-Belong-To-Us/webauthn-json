{"version":3,"sources":["../src/base64url.ts","../src/schema.ts","../src/webauthn-schema.ts","../src/webauthn.ts","state.ts","index.ts"],"names":["base64urlToBuffer","baseurl64String","padding","slice","length","base64String","replace","str","atob","buffer","ArrayBuffer","byteView","Uint8Array","i","charCodeAt","bufferToBase64url","charCode","String","fromCharCode","btoa","copyValue","convertValue","convert","conversionFn","schema","input","Array","map","v","Object","output","key","schemaField","entries","required","Error","optional","publicKeyCredentialDescriptorSchema","type","copy","id","transports","credentialCreationOptionsSchema","publicKey","rp","user","name","displayName","icon","challenge","pubKeyCredParams","timeout","excludeCredentials","authenticatorSelection","attestation","extensions","signal","publicKeyCredentialWithAttestationSchema","rawId","response","clientDataJSON","attestationObject","credentialRequestOptionsSchema","unmediated","mediation","rpId","allowCredentials","userVerification","publicKeyCredentialWithAssertionSchema","authenticatorData","signature","userHandle","async","create","requestJSON","request","credential","navigator","credentials","get"],"mappings":"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","file":"src.263c07c3.js","sourceRoot":"../src/src","sourcesContent":["export type Base64urlString = string;\n\nexport function base64urlToBuffer(baseurl64String: Base64urlString): ArrayBuffer {\n  // Base64url to Base64\n  const padding = \"==\".slice(0, (4 - (baseurl64String.length % 4)) % 4);\n  const base64String = baseurl64String.replace(/-/g, \"+\").replace(/_/g, \"/\") + padding;\n\n  // Base64 to binary string\n  const str = atob(base64String);\n\n  // Binary string to buffer\n  const buffer = new ArrayBuffer(str.length);\n  const byteView = new Uint8Array(buffer);\n  for (let i = 0; i < str.length; i++) {\n    byteView[i] = str.charCodeAt(i);\n  }\n  return buffer;\n}\n\nexport function bufferToBase64url(buffer: ArrayBuffer): Base64urlString {\n  // Buffer to binary string\n  const byteView = new Uint8Array(buffer);\n  let str = \"\";\n  for (const charCode of byteView) {\n    str += String.fromCharCode(charCode);\n  }\n\n  // Binary string to base64\n  const base64String = btoa(str);\n\n  // Base64 to base64url\n  // We assume that the base64 string is well-formed.\n  const base64urlString = base64String.replace(/\\+/g, \"-\").replace(/\\//g, \"_\").replace(/=/g, \"\");\n  return base64urlString;\n}\n","type SchemaLeaf = \"copy\" | \"convert\";\ninterface SchemaObject { [s: string]: SchemaField; }\ntype SchemaArray = [SchemaObject];\ninterface SchemaField {\n  required: boolean;\n  schema: Schema;\n}\n\nexport type Schema = SchemaLeaf | SchemaArray | SchemaObject;\n\n// We export these values in order so that they can be used to deduplicate\n// schema definitions in minified JS code.\nexport const copyValue = \"copy\";\nexport const convertValue = \"convert\";\n\nexport function convert<From, To>(conversionFn: (v: From) => To, schema: Schema, input: any): any {\n  if (schema === copyValue) {\n    return input;\n  }\n  if (schema === convertValue) {\n    return conversionFn(input);\n  }\n  if (schema instanceof Array) {\n    return input.map((v: any) => convert<From, To>(conversionFn, schema[0], v));\n  }\n  if (schema instanceof Object) {\n    const output: any = {};\n    for (const [key, schemaField] of Object.entries(schema)) {\n      if (!(key in input)) {\n        if (schemaField.required) {\n          throw new Error(`Missing key: ${key}`);\n        }\n        continue;\n      }\n      // Fields can be null (rather than missing or `undefined`), e.g. the\n      // `userHandle` field of the `AuthenticatorAssertionResponse`:\n      // https://www.w3.org/TR/webauthn/#iface-authenticatorassertionresponse\n      if (input[key] == null) {\n        output[key] = null;\n        continue;\n      }\n      output[key] = convert<From, To>(conversionFn, schemaField.schema, input[key]);\n    }\n    return output;\n  }\n}\n\nexport function required(schema: Schema): any {\n  return {\n    required: true,\n    schema,\n  };\n}\n\nexport function optional(schema: Schema): any {\n  return {\n    required: false,\n    schema,\n  };\n}\n","import {convertValue as convert, copyValue as copy, optional, required, Schema} from \"./schema\";\n\n// Shared by `create()` and `get()`.\n\nconst publicKeyCredentialDescriptorSchema: Schema = {\n  type: required(copy),\n  id: required(convert),\n  transports: optional(copy),\n};\n\n// `navigator.create()` request\n\nexport const credentialCreationOptionsSchema: Schema = {\n  publicKey: required({\n    rp: required(copy),\n    user: required({\n      id: required(convert),\n      name: required(copy),\n      displayName: required(copy),\n      icon: optional(copy),\n    }),\n\n    challenge: required(convert),\n    pubKeyCredParams: required(copy),\n\n    timeout: optional(copy),\n    excludeCredentials: optional([publicKeyCredentialDescriptorSchema]),\n    authenticatorSelection: optional(copy),\n    attestation: optional(copy),\n    extensions: optional(copy),\n  }),\n  signal: optional(copy),\n};\n\n// `navigator.create()` response\n\nexport const publicKeyCredentialWithAttestationSchema: Schema = {\n  type: required(copy),\n  id: required(copy),\n  rawId: required(convert),\n  response: required({\n    clientDataJSON: required(convert),\n    attestationObject: required(convert),\n  }),\n};\n\n// `navigator.get()` request\n\nexport const credentialRequestOptionsSchema: Schema = {\n  unmediated: optional(copy),\n  mediation: optional(copy),\n  publicKey: required({\n    challenge: required(convert),\n    timeout: optional(copy),\n    rpId: optional(copy),\n    allowCredentials: optional([publicKeyCredentialDescriptorSchema]),\n    userVerification: optional(copy),\n    extensions: optional(copy),\n  }),\n  signal: optional(copy),\n};\n\n// `navigator.get()` response\n\nexport const publicKeyCredentialWithAssertionSchema: Schema = {\n  type: required(copy),\n  id: required(copy),\n  rawId: required(convert),\n  response: required({\n    clientDataJSON: required(convert),\n    authenticatorData: required(convert),\n    signature: required(convert),\n    userHandle: required(convert),\n  }),\n};\n","import {base64urlToBuffer, bufferToBase64url} from \"./base64url\";\nimport {CredentialCreationOptionsJSON, CredentialRequestOptionsJSON, PublicKeyCredentialWithAssertionJSON, PublicKeyCredentialWithAttestationJSON} from \"./json\";\nimport {convert} from \"./schema\";\nimport {credentialCreationOptionsSchema, credentialRequestOptionsSchema, publicKeyCredentialWithAssertionSchema, publicKeyCredentialWithAttestationSchema} from \"./webauthn-schema\";\n\nexport async function create(requestJSON: CredentialCreationOptionsJSON): Promise<PublicKeyCredentialWithAttestationJSON> {\n  const request = convert(base64urlToBuffer, credentialCreationOptionsSchema, requestJSON);\n  const credential = (await navigator.credentials.create(request)) as PublicKeyCredential;\n  return convert(bufferToBase64url, publicKeyCredentialWithAttestationSchema, credential);\n}\n\nexport async function get(requestJSON: CredentialRequestOptionsJSON): Promise<PublicKeyCredentialWithAssertionJSON> {\n  const request = convert(base64urlToBuffer, credentialRequestOptionsSchema, requestJSON);\n  const response = (await navigator.credentials.get(request)) as PublicKeyCredential;\n  return convert(bufferToBase64url, publicKeyCredentialWithAssertionSchema, response);\n}\n","import { PublicKeyCredentialWithAttestationJSON } from \"@github/webauthn-json\";\n\nexport function getRegistrations(): PublicKeyCredentialWithAttestationJSON[] {\n  const registrations = JSON.parse(localStorage.webauthnExampleRegistrations || \"[]\");\n  return registrations;\n}\n\nexport function setRegistrations(registrations: PublicKeyCredentialWithAttestationJSON[], display: boolean = true): void {\n  localStorage.webauthnExampleRegistrations = JSON.stringify(registrations, null, \"  \");\n  displayRegistrations();\n}\n\nexport function saveRegistration(registration: PublicKeyCredentialWithAttestationJSON): void {\n  const registrations = getRegistrations();\n  registrations.push(registration);\n  setRegistrations(registrations);\n}\n\nfunction registrationElem(): HTMLTextAreaElement {\n  return document.querySelector(\"#registrations\");\n}\n\nexport function displayRegistrations() {\n  registrationElem().value = JSON.stringify(getRegistrations(), null, \"  \");\n}\n\nexport function withStatus(selector: string, fn: () => Promise<void>) {\n  return async function() {\n    document.querySelector(\"#error\").textContent = \"\";\n    document.querySelector(selector).textContent = \"…\";\n    try {\n      await fn();\n      document.querySelector(selector).textContent = \" ✅\";\n    } catch (e) {\n      document.querySelector(selector).textContent = \" ❌\";\n      console.error(e);\n      document.querySelector(\"#error\").textContent = e;\n    }\n  }\n}\n\nasync function saveInput(): Promise<void> {\n  document.querySelector(\"#error\").textContent = \"\";\n  registrationElem().style.backgroundColor = \"rgba(255, 127, 0, 0.5)\";\n  try {\n    setRegistrations(JSON.parse(registrationElem().value), false);\n    registrationElem().style.backgroundColor = \"rgba(0, 255, 0, 0.5)\";\n  } catch (e) {\n    registrationElem().style.backgroundColor = \"rgba(255, 0, 0, 0.5)\";\n    console.error(e);\n    document.querySelector(\"#error\").textContent = e;\n  }\n}\n\nwindow.addEventListener(\"load\", function() {\n  try {\n    displayRegistrations();\n    registrationElem().addEventListener(\"keyup\", saveInput);\n    registrationElem().addEventListener(\"change\", saveInput);\n    registrationElem().addEventListener(\"paste\", saveInput);\n  } catch(e) {\n    console.error(e);\n  }\n});\n","// A minimal example to test `webauthn-json`.\n// Note: do not hardcode values in production.\n\nimport {create, get} from \"@github/webauthn-json\"\nimport { saveRegistration, getRegistrations, setRegistrations, withStatus } from \"./state\";\nimport { PublicKeyCredentialDescriptorJSON } from \"@github/webauthn-json/dist/src/json\";\n\nfunction registeredCredentials(): PublicKeyCredentialDescriptorJSON[] {\n  return getRegistrations().map((reg) => ({\n    id: reg.rawId,\n    type: reg.type\n  }))\n}\n\nasync function register(): Promise<void> {\n  saveRegistration(await create({\n    publicKey: {\n      challenge: \"CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC\",\n      rp: {name: \"Localhost, Inc.\"},\n      user: {id: \"IIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIIII\", name: \"test_user\", displayName: \"Test User\"},\n      pubKeyCredParams: [{type: \"public-key\", alg: -7}],\n      excludeCredentials: registeredCredentials()\n    }\n  }));\n}\n\nasync function authenticate(): Promise<void> {\n  await get({\n    publicKey: {\n      challenge: \"CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC\",\n      allowCredentials: getRegistrations().map((reg) => ({\n        id: reg.rawId,\n        type: reg.type\n      }))\n    }\n  });\n}\n\nasync function clear(): Promise<void> {\n  setRegistrations([]);\n}\n\nwindow.addEventListener(\"load\", function() {\n  try {\n    document.querySelector(\"#register\").addEventListener(\"click\", withStatus(\"#register .status\", register));\n    document.querySelector(\"#authenticate\").addEventListener(\"click\", withStatus(\"#authenticate .status\", authenticate));\n    document.querySelector(\"#clear\").addEventListener(\"click\", withStatus(\"#clear .status\", clear));\n  } catch(e) {\n    console.error(e);\n  }\n})\n"]}